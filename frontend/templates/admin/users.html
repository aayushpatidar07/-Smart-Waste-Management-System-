{% extends "admin/dashboard.html" %}

{% block title %}User Management - Admin{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-people"></i> User Management</h2>
            <p class="text-muted">Manage system users</p>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header bg-white">
            <ul class="nav nav-tabs card-header-tabs">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#allUsers">All Users</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#staff">Staff</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#citizens">Citizens</a>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content">
                <div class="tab-pane fade show active" id="allUsers">
                    <div class="table-responsive">
                        <table class="table table-hover" id="allUsersTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Full Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="7" class="text-center py-4">
                                        <div class="spinner-border text-primary"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    loadUsers();
});

function loadUsers() {
    $.get('/api/users', function(data) {
        const tbody = $('#allUsersTable tbody');
        tbody.empty();
        
        if (!data || data.length === 0) {
            tbody.append('<tr><td colspan="7" class="text-center text-muted">No users found</td></tr>');
            return;
        }
        
        data.forEach(user => {
            const roleClass = {
                'admin': 'danger',
                'staff': 'primary',
                'citizen': 'info'
            }[user.role] || 'secondary';
            
            const statusClass = user.status === 'active' ? 'success' : 'secondary';
            
            tbody.append(`
                <tr>
                    <td>${user.user_id}</td>
                    <td><strong>${user.username}</strong></td>
                    <td>${user.full_name}</td>
                    <td>${user.email}</td>
                    <td><span class="badge bg-${roleClass}">${user.role}</span></td>
                    <td><span class="badge bg-${statusClass}">${user.status}</span></td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                </tr>
            `);
        });
    });
}
</script>
{% endblock %}
